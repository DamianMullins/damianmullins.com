<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Using PowerShell to overcome node_modules directory woes - Damian mullins" />

    <title>Use PowerShell to npm uninstall all packages - DamianMullins.com - Development Blog for Damian mullins</title>

    <!--[if lte IE 8]><link rel="stylesheet" href="/assets/dist/css/kickoff-old-ie.css"><![endif]-->
    <!--[if gt IE 8]><!--><link rel="stylesheet" href="/assets/css/style.css"><!--<![endif]-->
    
    <link href="http://feeds.feedburner.com/damianmullins" rel="alternate" type="application/rss+xml" title="Development Blog for Damian mullins" />
    
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/assets/img/icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/img/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/icons/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#272525">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#272525">

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@DJMelonz" />
    <meta name="twitter:creator" content="@DJMelonz" />
    <meta name="twitter:title" content="Use PowerShell to npm uninstall all packages" />
    <meta name="twitter:description" content="Using PowerShell to overcome node_modules directory woes" />
    <meta name="twitter:image" content="http://www.damianmullins.com/assets/img/logo-tcard.png" />
</head>

<body>


<div class="skipToContent">
    <a href="#mainContent" class="btn btn--primary">Skip to main content</a>
</div>

<header class="header">
    <div class="l-container">
        <div class="header-logo">
            <a href="/"><img alt="Damian's avatar" src="/assets/img/plus_djmelonz.png" /></a>
        </div>
    </div>
</header>


<main id="mainContent" class="section">
    <div class="l-container post">
        <header>
            <h1 class="post-heading">Use PowerShell to npm uninstall all packages</h1>
        </header>
        
        <p class="post-date">Posted <time datetime="2015-07-23T14:18:00">23rd July 2015</time>

            
        </p>
        
        <p>Recently I needed to delete all npm package folders which had been installed into the <code>node_modules</code> directory of a project. Attempting to manually delete the folders occasionally failed due to the <a href="https://msdn.microsoft.com/en-us/library/aa365247%28v=vs.85%29.aspx#maxpath">maximum path length limitation</a> Windows imposes. I didn&#39;t fancy running <code>npm uninstall</code> for each package individually as there were a lot of them, and knowing that I would likely need to repeat this task again I decided to try my hand at writing some PowerShell to uninstall each package listed in either the <code>devDependencies</code> section of <code>package.json</code>, or in the <code>node_modules</code> directory itself. </p>
<h2 id="uninstall-packages-attempt-one">Uninstall packages, attempt one</h2>
<p>First up I wrote a function which removes package folders added by a reference in <code>devDependencies</code>.</p>
<pre><code class="language-bash">Function Uninstall-NpmPackagesInDevDependencies {
    Param (
        <span class="comment"># Optional path to package.json</span>
        [String]<span class="variable">$pathToPackage</span>= $(Resolve-Path <span class="string">"package.json"</span>)
    )

    <span class="comment"># Read the json content</span>
    <span class="variable">$json</span> = (Get-Content <span class="variable">$pathToPackage</span> -Raw) | ConvertFrom-Json

    <span class="comment"># Loop over each package in devDependencies</span>
    ForEach (<span class="variable">$dep</span> <span class="keyword">in</span> (<span class="variable">$json</span>.devDependencies | Get-Member -MemberType *Property).Name) {
        <span class="comment"># Uninstall the package</span>
        iex <span class="string">"npm uninstall <span class="variable">$dep</span>"</span>
    }
}</code></pre>
<p>It works! However a few pesky folders still remained as they were saved in another section of the <code>package.json</code>.</p>
<h2 id="uninstall-packages-attempt-two">Uninstall packages, attempt two</h2>
<p>To deal with the leftover folders I created a second function which loops over all folders in the <code>node_modules</code> directory and uses the name of each folder to uninstall the package.</p>
<pre><code class="language-bash">Function Uninstall-NpmPackagesInNodeModules {
    Param (
        <span class="comment"># Optional path to node_modules directory</span>
        [String]<span class="variable">$pathToNodeModules</span> = (Get-Item <span class="string">".\node_modules"</span>).FullName
    )

    Get-ChildItem <span class="variable">$pathToNodeModules</span> | ForEach {
        <span class="comment"># Uninstall the package</span>
        iex <span class="string">"npm uninstall <span class="variable">$($_.Name)</span>"</span>
    }
}</code></pre>
<p>Trying out slightly different ForEach syntax for a bit of fun, I managed to remove all directories, regardless of whether the packages were saved in <code>package.json</code> or the path length was too long.</p>
<h2 id="one-liners">One liners</h2>
<p>After some further searching online I came across a nice <a href="http://blog.legacyteam.info/2014/10/how-to-remove-all-local-npm-packages/">bash command</a> for this sort of thing:</p>
<pre><code class="language-bash"><span class="keyword">for</span> package <span class="keyword">in</span> `ls node_modules`; <span class="keyword">do</span> npm uninstall <span class="variable">$package</span>; <span class="keyword">done</span>;</code></pre>
<p>Which led me to wonder what the equivilent would be if I shortened the <code>Uninstall-NpmPackagesInDirectory</code> function. </p>
<p>Stripping the function right back, and substituting method names for their shorter aliases resulted in</p>
<pre><code class="language-bash">ls (gi <span class="string">".\node_modules"</span>).FullName | % { iex <span class="string">"npm uninstall <span class="variable">$($_.Name)</span>"</span> }</code></pre>
<p>It doesn&#39;t read as well as the bash command, but I don&#39;t think it&#39;s too bad.</p>
<p>Just for the hell of it I thought I&#39;d have a go at shortening the <code>Uninstall-NpmPackagesInDevDependencies</code> function as well, the result:</p>
<pre><code class="language-bash">($(gc <span class="string">"package.json"</span> -raw) | convertfrom-json).devdependencies | gm -membertype *property | % { iex <span class="string">"npm uninstall <span class="variable">$dep</span>"</span> }</code></pre>
<p>Not likely to remember that one off the top of my head the next time I need to use it.. </p>

    </div>
</main>

<div class="section">
    <div id="disqus_thread" class="l-container"></div>
</div>


    <section class="related section section--dark">
        <div class="l-container">
            <header>
                <h1>Related Posts</h1>
            </header>
            
            <div class="articles u-noMargin">
                

    <article class="articles-item">
        <a href="/blog/importing-asp-net-5-tag-helpers">
            <h2 class="articles-item-title">Importing ASP.NET MVC 6 Tag Helpers</h2>
            <time datetime="2015-08-20T09:46:00" class="articles-item-posted">20th August 2015</time>
        </a>
    </article>

    <article class="articles-item">
        <a href="/blog/my-first-week-with-python-django">
            <h2 class="articles-item-title">My first week with Python, Django &amp; Google App Engine</h2>
            <time datetime="2012-08-16T13:35:00" class="articles-item-posted">16th August 2012</time>
        </a>
    </article>


            </div>
        </div>
    </section>


<div class="newsletter section section--medium">
    <div class="l-container l-container--narrow">
        <header>
            <h1>Sign up to my newsletter!</h1>
        </header>
        
<p>Need Input is a newsletter comprised of anything and everything web related, from HTTP to SVG; CSS to JSX; W3C to PNG; Lovingly crafted by myself each week.</p>


        
<form class="newsletter-form" action="https://www.getrevue.co/profile/need-input/add_subscriber" method="post" name="revue-form" target="_blank">  
    <div class="form-controlGroup">
        <label class="form-label is-visuallyHidden" for="member_email">Email address</label>
        <div class="form-controlGroup-inputWrapper">
            <input class="form-input" id="member_email" placeholder="Your email address..." type="email" name="member[email]" required="required">
        </div>
    </div>
    <button class="btn btn--primary" type="submit" name="member[subscribe]">Subscribe</button>
</form>

    </div>
</div>


<footer class="footer section section--dark">
    <div class="l-container l-container--narrow">
        <p>Hi, I'm Damian Mullins, a Software engineer working at Just Eat. Cranking out code in C#, JavaScript, CSS &amp; others, always looking to learn more!</p>
        
        <ul class="unstyled footer-socialLinks">
    <li class="footer-link"><a href="mailto:hello@damianmullins.com" rel="external" title="Contact me via email">Email</a></li>
    <li class="footer-link"><a href="https://github.com/DJMelonz" rel="external" title="View my GitHub profile">GitHub</a></li>
    <li class="footer-link"><a href="https://twitter.com/DJMelonz" rel="external" title="Talk to me on Twitter">Twitter</a></li>
    <li class="footer-link"><a href="https://uk.linkedin.com/in/damianmullins" rel="external" title="View my LinkedIn profile">LinkedIn</a></li>
</ul>

        
        <p class="footer-copyright">&copy; 2016 Damian Mullins</p>
    </div>
</footer>


<script>
!function(){var e=document,a=e.createElement("script");a.type="text/javascript",a.async=!0,a.src="//damianmullins.disqus.com/embed.js",(e.getElementsByTagName("head")[0]||e.getElementsByTagName("body")[0]).appendChild(a)}();
</script>


    
    
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-1425869-12', 'auto');
    ga('send', 'pageview');
</script>

</body>

</html>

