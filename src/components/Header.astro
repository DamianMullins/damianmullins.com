---
import ThemeToggle from '@/components/ThemeToggle.astro'
import { SITE_TITLE } from '@/consts'
---

<header
  id="site-header"
  class="bg-bg/95 sticky top-0 z-50 backdrop-blur-sm transition-transform duration-300 after:pointer-events-none after:absolute after:inset-x-0 after:-bottom-6 after:h-6 after:bg-gradient-to-b after:from-[var(--color-bg)]/60 after:to-transparent after:content-['']">
  <div class="mx-auto flex max-w-170 items-center justify-between px-6 py-4">
    <a
      href="/"
      class="font-heading text-heading text-xl font-bold tracking-tight no-underline">
      {SITE_TITLE}
    </a>
    <ThemeToggle />
  </div>
</header>

<script>
  function initHeader() {
    const header = document.getElementById('site-header') as HTMLElement | null
    if (!header) return

    let lastScrollY = window.scrollY
    let ticking = false

    function onScroll() {
      if (ticking) return
      ticking = true

      requestAnimationFrame(() => {
        const currentScrollY = window.scrollY

        if (currentScrollY > lastScrollY && currentScrollY > 80) {
          header!.style.transform = 'translateY(-100%)'
        } else {
          header!.style.transform = 'translateY(0)'
        }

        lastScrollY = currentScrollY
        ticking = false
      })
    }

    window.addEventListener('scroll', onScroll, { passive: true })
  }

  initHeader()
  document.addEventListener('astro:after-swap', initHeader)
</script>
