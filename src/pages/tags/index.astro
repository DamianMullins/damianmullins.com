---
import Layout from '@/layouts/Layout.astro'
import { getCollection } from 'astro:content'
import slugify from 'slugify'

const posts = await getCollection('posts', ({ data }) => data.published)

const tagCounts = new Map<string, number>()
for (const post of posts) {
  for (const tag of post.data.tags) {
    tagCounts.set(tag, (tagCounts.get(tag) ?? 0) + 1)
  }
}

const sortedTags = [...tagCounts.entries()].sort((a, b) =>
  a[0].localeCompare(b[0])
)
---

<Layout title="Tags">
  <h1 class="font-heading text-heading mb-8">Tags</h1>
  <ul class="m-0 flex list-none flex-wrap gap-3 p-0">
    {
      sortedTags.map(([tag, count]) => (
        <li>
          <a
            href={`/tags/${slugify(tag)}/`}
            class="border-divider bg-surface text-accent inline-block rounded-full border px-4 py-2 text-sm no-underline transition-colors">
            {tag} ({count})
          </a>
        </li>
      ))
    }
  </ul>
</Layout>
